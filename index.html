<script>
let lastHTML = "";

// تحويل ملف إلى base64
function fileToBase64(file, callback){
    if(!file){ callback(''); return; }
    const reader = new FileReader();
    reader.onload = ()=>callback(reader.result);
    reader.readAsDataURL(file);
}

// توليد الصفحة
function generatePage(){
    const profileFile = document.getElementById('profileImg').files[0];
    const logoFile = document.getElementById('logoImg').files[0];
    const cvFile = document.getElementById('cvFile').files[0];

    fileToBase64(profileFile, profileBase64=>{
        fileToBase64(logoFile, logoBase64=>{
            fileToBase64(cvFile, cvBase64=>{
                
                // HTML النهائي
                lastHTML = `
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>صفحة الرئيس</title>
</head>
<body>
<h1>الرئيس: علي محمد عيسى اسحاقي</h1>
<img src="${profileBase64}" alt="الصورة الشخصية" width="150">
<img src="${logoBase64}" alt="شعار الاتحاد" width="100">
<p>البريد الإلكتروني: example@email.com</p>
<p>الهاتف: 0000-0000</p>
<a href="${cvBase64}" download="CV.pdf">تحميل السيرة الذاتية</a>
</body>
</html>
                `;

                // عرض المعاينة
                document.getElementById('previewFrame').srcdoc = lastHTML;

            }); // نهاية callback cvFile
        }); // نهاية callback logoFile
    }); // نهاية callback profileFile
}

// تحميل HTML النهائي
function downloadPage(){
    if(!lastHTML){ 
        alert("يجب توليد الصفحة أولاً"); 
        return; 
    }
    const blob = new Blob([lastHTML], {type:"text/html"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "profile_page.html";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>
